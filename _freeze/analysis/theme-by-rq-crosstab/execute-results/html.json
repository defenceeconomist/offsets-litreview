{
  "hash": "71981a7a7c6aeab058b80951efdabb9d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"CMO Counts: Mechanism Theme Ã— Research Question\"\nformat: html\nfreeze: true\n---\n\nThis note cross-tabulates **mechanism themes** (from `data/mechanism_themes/proto_themes.yml`) by **research question** (from `data/cmo_statements.csv`), counting CMO statements per cell.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(readr)\nlibrary(yaml)\nlibrary(purrr)\nlibrary(stringr)\nlibrary(knitr)\n\ncmo_path <- \"data/cmo_statements.csv\"\nthemes_path <- \"data/mechanism_themes/proto_themes.yml\"\n\ncmo <- readr::read_csv(cmo_path, show_col_types = FALSE)\n\nthemes_raw <- yaml::read_yaml(themes_path)\nthemes <- themes_raw$proto_mechanism_themes %||% list()\n\ntheme_map <- purrr::map_dfr(themes, function(t) {\n  mechs <- t$mechanisms %||% list()\n  if (length(mechs) == 0) {\n    return(tibble::tibble())\n  }\n  tibble::tibble(\n    chunk_id = vapply(mechs, function(m) as.character(m$id), character(1)),\n    theme_id = as.character(t$theme_id),\n    theme_label = as.character(t$theme_label)\n  )\n})\n\ndup_assignments <- theme_map |>\n  count(chunk_id, name = \"n_themes\") |>\n  filter(n_themes > 1)\n\ndf_joined <- cmo |>\n  left_join(theme_map, by = \"chunk_id\")\n\ndf <- df_joined |>\n  mutate(\n    theme_id = if_else(is.na(theme_id), \"UNMAPPED_THEME\", theme_id),\n    theme_label = if_else(is.na(theme_label), \"Unmapped theme\", theme_label),\n    rq = str_split(coalesce(research_question_mapped, \"\"), \";\\\\s*\")\n  ) |>\n  unnest(rq) |>\n  mutate(rq = str_trim(rq)) |>\n  mutate(rq = if_else(rq == \"\", \"UNMAPPED_RQ\", rq))\n\ncounts <- df |>\n  count(theme_id, theme_label, rq, name = \"n_cmo\")\n\nrq_order <- counts |>\n  distinct(rq) |>\n  mutate(\n    rq_num = suppressWarnings(as.integer(str_match(rq, \"^rq(\\\\d+)$\")[, 2])),\n    rq_is_num = !is.na(rq_num)\n  ) |>\n  arrange(desc(rq_is_num), rq_num, rq) |>\n  pull(rq)\n\ncrosstab <- counts |>\n  mutate(rq = factor(rq, levels = rq_order)) |>\n  tidyr::pivot_wider(names_from = rq, values_from = n_cmo, values_fill = 0) |>\n  mutate(total = rowSums(across(where(is.numeric)))) |>\n  arrange(desc(total), theme_id)\n\nlist(\n  n_cmo_rows = nrow(cmo),\n  n_themes = dplyr::n_distinct(theme_map$theme_id),\n  n_unmapped_theme_chunk_ids = sum(is.na(df_joined$theme_id)),\n  n_unmapped_rq_chunk_ids = sum(is.na(df_joined$research_question_mapped) | str_trim(df_joined$research_question_mapped) == \"\"),\n  n_multi_theme_chunk_ids = nrow(dup_assignments)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$n_cmo_rows\n[1] 388\n\n$n_themes\n[1] 81\n\n$n_unmapped_theme_chunk_ids\n[1] 1\n\n$n_unmapped_rq_chunk_ids\n[1] 0\n\n$n_multi_theme_chunk_ids\n[1] 11\n```\n\n\n:::\n:::\n\n\n## Cross-tab\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::kable(crosstab)\n```\n\n::: {.cell-output-display}\n\n\n|theme_id       |theme_label                                         | rq1| rq2| rq3| rq5| rq4| total|\n|:--------------|:---------------------------------------------------|---:|---:|---:|---:|---:|-----:|\n|PM34           |Capability gains not self-sustaining                |   6|  14|  34|  20|   1|    75|\n|PM36           |Illiberal contracting builds cross-border ties      |   8|  27|  11|   2|  13|    61|\n|PM15           |Flexibility reduces mandate diseconomies            |   6|  15|  27|   3|   7|    58|\n|PM2            |Compliance shaped by incentives and monitoring      |   1|   4|  44|   3|   0|    52|\n|PM7            |Training expands local skill supply                 |  17|  20|   9|   1|   1|    48|\n|PM17           |Administrative burden and rent-seeking              |   0|   0|  22|  17|   0|    39|\n|PM1            |Legitimation through economic framing               |   3|   5|  12|   2|   0|    22|\n|PM19           |Supplier coaching and reputational certification    |   2|  15|   1|   0|   0|    18|\n|PM8            |Transferability and contextual fit                  |   0|   4|   8|   2|   0|    14|\n|PM3            |Cost pass-through via pricing                       |   0|   0|  11|   1|   0|    12|\n|PM4            |Offsets crowd out civilian resources                |   0|   0|   7|   4|   0|    11|\n|PM46           |Absorptive capacity conditions outcomes             |   2|   4|   2|   3|   0|    11|\n|PM54           |Technology acquisition via licensed production      |   3|   4|   3|   0|   0|    10|\n|PM21           |Market access conditioned on reciprocity            |   1|   2|   6|   0|   0|     9|\n|PM30           |Second-best offsets distort allocation              |   0|   0|   5|   2|   0|     7|\n|PM5            |External finance expands resource pool              |   2|   2|   3|   0|   0|     7|\n|PM10           |Offsets as supplier differentiator                  |   0|   0|   6|   0|   0|     6|\n|PM9            |Barter eases constraints, reduces transparency      |   0|   0|   5|   0|   0|     5|\n|PM16           |Offsets justified in high-hazard exchanges          |   0|   1|   3|   0|   0|     4|\n|PM20           |Alliance incentives via offset waivers              |   0|   2|   1|   0|   0|     3|\n|PM23           |Sourcing persists only when viable                  |   0|   2|   1|   0|   0|     3|\n|PM24           |Indirect offsets stimulate targeted exports         |   0|   0|   3|   0|   0|     3|\n|PM14           |Rent extraction via offset requirements             |   0|   1|   1|   0|   0|     2|\n|PM22           |Offsets reveal local supplier capability            |   0|   1|   1|   0|   0|     2|\n|PM27           |Depreciation drives tech licensing                  |   0|   1|   1|   0|   0|     2|\n|PM28           |Exporter networks reduce market entry costs         |   0|   1|   1|   0|   0|     2|\n|PM33           |Export subsidies offset scale gains                 |   0|   0|   2|   0|   0|     2|\n|PM35           |Offsets displace rather than add trade              |   0|   0|   2|   0|   0|     2|\n|PM37           |Buyer pool expansion loosens controls               |   1|   0|   1|   0|   0|     2|\n|PM38           |Firms build offset-management capacity              |   0|   0|   2|   0|   0|     2|\n|PM39           |Hidden injuries from offset competition             |   0|   0|   2|   0|   0|     2|\n|PM40           |Offsets accelerate next-generation development      |   1|   0|   1|   0|   0|     2|\n|PM45           |Security urgency overrides offset aims              |   1|   0|   1|   0|   0|     2|\n|PM49           |Second-best import offset rules                     |   0|   1|   1|   0|   0|     2|\n|PM50           |Offset design to protect value-for-money            |   1|   1|   0|   0|   0|     2|\n|PM52           |Additionality enforced through credit rules         |   0|   0|   2|   0|   0|     2|\n|PM53           |Embedded offsets via procurement structure          |   0|   1|   1|   0|   0|     2|\n|PM56           |Fair-return reform improves collaboration           |   1|   1|   0|   0|   0|     2|\n|PM57           |Export support builds offset capacity               |   0|   1|   1|   0|   0|     2|\n|PM58           |Complex governance raises transaction costs         |   1|   0|   1|   0|   0|     2|\n|PM6            |Additional trade yields net gains                   |   0|   0|   2|   0|   0|     2|\n|PM61           |Offset dependence reduces design capability         |   1|   1|   0|   0|   0|     2|\n|PM62           |Early partnership enables high-tech roles           |   1|   1|   0|   0|   0|     2|\n|PM66           |Offsets as import compensation                      |   0|   1|   1|   0|   0|     2|\n|PM70           |Offsets excluded from supplier selection            |   1|   0|   1|   0|   0|     2|\n|PM71           |Subcontracting buy-in reduces influence             |   0|   1|   1|   0|   0|     2|\n|PM77           |Heterogeneity limits generalization                 |   0|   0|   2|   0|   0|     2|\n|PM11           |Domestic industry influence on offsets              |   0|   0|   1|   0|   0|     1|\n|PM12           |Development-oriented indirect offset design         |   0|   0|   1|   0|   0|     1|\n|PM13           |Offsets shift competition to bundled content        |   0|   0|   1|   0|   0|     1|\n|PM18           |Objective ambiguity undermines evaluation           |   0|   0|   1|   0|   0|     1|\n|PM25           |Opacity enables price discrimination                |   0|   0|   1|   0|   0|     1|\n|PM26           |Buyback hostage aligns incentives                   |   0|   0|   1|   0|   0|     1|\n|PM29           |Bundled contracting reduces transaction costs       |   0|   0|   1|   0|   0|     1|\n|PM31           |Labour rents drive opposition to offsets            |   0|   0|   1|   0|   0|     1|\n|PM32           |Offset competition redistributes rents              |   0|   0|   1|   0|   0|     1|\n|PM41           |Economic priorities override security restraint     |   0|   0|   1|   0|   0|     1|\n|PM42           |Offsets increase defence budget appeal              |   0|   0|   1|   0|   0|     1|\n|PM43           |Opacity weakens cost discipline                     |   0|   0|   1|   0|   0|     1|\n|PM44           |Offsets preserve market power                       |   0|   0|   1|   0|   0|     1|\n|PM47           |Opacity and bargaining drive uncertainty            |   0|   0|   1|   0|   0|     1|\n|PM48           |Institutional path dependence in offset policy      |   0|   0|   1|   0|   0|     1|\n|PM51           |Offset reciprocity and supply-chain risk            |   0|   0|   1|   0|   0|     1|\n|PM55           |Subsidiary entry then consolidation                 |   0|   1|   0|   0|   0|     1|\n|PM59           |Additionality undermined by baseline credit         |   0|   0|   1|   0|   0|     1|\n|PM60           |Offsets justify imports despite inefficiency        |   0|   0|   1|   0|   0|     1|\n|PM63           |Partnership structures shape risk exposure          |   0|   1|   0|   0|   0|     1|\n|PM64           |IP studies as biased marketing signals              |   0|   0|   1|   0|   0|     1|\n|PM65           |Partnership packages build durable collaboration    |   0|   1|   0|   0|   0|     1|\n|PM67           |Transparency reforms target inflated credits        |   0|   0|   1|   0|   0|     1|\n|PM68           |Banking limits preserve procurement linkage         |   0|   0|   1|   0|   0|     1|\n|PM69           |Enforcement choice trades off price effects         |   0|   0|   1|   0|   0|     1|\n|PM72           |Complexity hinders auditability                     |   0|   0|   1|   0|   0|     1|\n|PM73           |Policy relaxation after poor returns                |   0|   0|   1|   0|   0|     1|\n|PM74           |Disclosure constraints obscure evaluation           |   0|   0|   1|   0|   0|     1|\n|PM75           |Counterfactual uncertainty undermines additionality |   0|   0|   1|   0|   0|     1|\n|PM76           |Compliance risk increases prices                    |   0|   0|   1|   0|   0|     1|\n|PM78           |Exports concentrate in incumbents                   |   0|   0|   1|   0|   0|     1|\n|PM79           |Evaluation uncertainty weakens value claims         |   0|   0|   1|   0|   0|     1|\n|PM80           |Firm gains but weak national benefit                |   0|   0|   1|   0|   0|     1|\n|PM81           |Offsets extend activity beyond program life         |   0|   0|   1|   0|   0|     1|\n|UNMAPPED_THEME |Unmapped theme                                      |   0|   0|   1|   0|   0|     1|\n\n\n:::\n:::\n\n\n## Notes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (nrow(dup_assignments) > 0) {\n  dup_assignments |> arrange(desc(n_themes), chunk_id) |> head(20) |> knitr::kable()\n} else {\n  \"No CMO chunk_ids appear in multiple themes.\"\n}\n```\n\n::: {.cell-output-display}\n\n\n|chunk_id                                                                           | n_themes|\n|:----------------------------------------------------------------------------------|--------:|\n|05_arms_trade_as_illiberal_trade_pdf__cmo_014                                      |        2|\n|08_offsets_and_the_joint_strike_fighter_in_the_uk_and_the_netherlands_pdf__cmo_004 |        2|\n|08_offsets_and_the_joint_strike_fighter_in_the_uk_and_the_netherlands_pdf__cmo_005 |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_005                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_006                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_007                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_008                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_010                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_011                      |        2|\n|09_nordic_offset_policies_changes_and_challenges_pdf__cmo_012                      |        2|\n|10_evaluating_defense_offsets_the_experience_in_finland_and_sweden_pdf__cmo_009    |        2|\n\n\n:::\n:::\n\n",
    "supporting": [
      "theme-by-rq-crosstab_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}